<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>US Dialect Detective Agency</title>
    
    <!-- Google Fonts: Poppins for headings, Inter for body text -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&family=Poppins:wght@600;700;800&display=swap" rel="stylesheet">

    <style>
        /* --- CSS VARIABLES & RESET --- */
        :root {
            --primary: #4F46E5;       /* Indigo 600 */
            --primary-hover: #4338CA; /* Indigo 700 */
            --primary-light: #E0E7FF; /* Indigo 100 */
            --success: #10B981;       /* Emerald 500 */
            --success-bg: #ECFDF5;    /* Emerald 50 */
            --error: #EF4444;         /* Red 500 */
            --error-bg: #FEF2F2;      /* Red 50 */
            --surface: #ffffff;
            --bg-app: #F3F4F6;        /* Cool Gray 100 */
            --text-main: #1F2937;     /* Cool Gray 800 */
            --text-muted: #6B7280;    /* Cool Gray 500 */
            --shadow-sm: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
            --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
            --radius: 12px;
            --transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
        }

        * { box-sizing: border-box; }
        
        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--bg-app);
            color: var(--text-main);
            margin: 0;
            padding: 20px;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        /* --- UTILITIES --- */
        .hidden { display: none !important; }
        .sr-only {
            position: absolute; width: 1px; height: 1px; padding: 0; margin: -1px;
            overflow: hidden; clip: rect(0, 0, 0, 0); border: 0;
        }
        
        /* --- LAYOUT CONTAINER --- */
        .app-container {
            width: 100%;
            max-width: 800px;
            background: var(--surface);
            border-radius: var(--radius);
            box-shadow: var(--shadow-lg);
            overflow: hidden;
            animation: fadeIn 0.5s ease-out;
        }

        /* --- HEADER --- */
        header {
            background: linear-gradient(135deg, #4F46E5 0%, #06B6D4 100%);
            padding: 30px 20px;
            text-align: center;
            color: white;
        }

        h1 {
            font-family: 'Poppins', sans-serif;
            font-weight: 800;
            font-size: 2rem;
            margin: 0;
            letter-spacing: -0.5px;
            text-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .subtitle {
            margin-top: 8px;
            font-weight: 500;
            opacity: 0.9;
            font-size: 1.1rem;
        }

        /* --- SECTIONS --- */
        .content-area {
            padding: 32px;
        }

        h2 {
            font-family: 'Poppins', sans-serif;
            font-size: 1.5rem;
            margin-top: 0;
            color: var(--text-main);
            margin-bottom: 16px;
        }

        p { line-height: 1.6; color: var(--text-muted); }

        /* --- CHARACTER GRID --- */
        .case-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
            gap: 20px;
            margin-top: 24px;
        }

        .case-file {
            background: white;
            border: 2px solid #E5E7EB;
            border-radius: var(--radius);
            padding: 24px;
            cursor: pointer;
            transition: var(--transition);
            text-align: center;
            position: relative;
        }

        .case-file:hover, .case-file:focus-visible {
            transform: translateY(-4px);
            border-color: var(--primary);
            box-shadow: var(--shadow-md);
            outline: none;
        }

        .case-emoji { font-size: 3rem; margin-bottom: 12px; display: block; }
        
        .case-badge {
            background: var(--primary-light);
            color: var(--primary);
            font-size: 0.75rem;
            font-weight: 700;
            text-transform: uppercase;
            padding: 4px 8px;
            border-radius: 4px;
            letter-spacing: 1px;
        }

        /* --- QUIZ INTERFACE --- */
        .mission-dossier {
            background: #FFFBEB; /* Amber 50 */
            border-left: 5px solid #F59E0B; /* Amber 500 */
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 30px;
            position: relative;
        }

        .dossier-label {
            font-weight: 700;
            text-transform: uppercase;
            color: #92400E;
            font-size: 0.85rem;
            margin-bottom: 8px;
            display: block;
        }

        .dialogue-text {
            font-family: 'Georgia', serif;
            font-size: 1.25rem;
            font-style: italic;
            color: #1F2937;
            background: white;
            padding: 16px;
            border-radius: 8px;
            box-shadow: var(--shadow-sm);
            border: 1px solid #E5E7EB;
        }

        /* --- PROGRESS BAR --- */
        .progress-container {
            margin-bottom: 24px;
        }
        
        .progress-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
            font-weight: 600;
            font-size: 0.9rem;
            color: var(--primary);
        }

        .progress-track {
            width: 100%;
            height: 10px;
            background: #E5E7EB;
            border-radius: 99px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: var(--primary);
            width: 0%;
            transition: width 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        }

        /* --- QUESTIONS & OPTIONS --- */
        .question-text {
            font-weight: 700;
            font-size: 1.25rem;
            color: var(--text-main);
            margin-bottom: 20px;
        }

        .options-list {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .option-btn {
            background: white;
            border: 2px solid #E5E7EB;
            border-radius: 10px;
            padding: 16px 20px;
            text-align: left;
            font-size: 1rem;
            font-family: 'Inter', sans-serif;
            color: var(--text-main);
            cursor: pointer;
            transition: var(--transition);
            position: relative;
            display: flex;
            align-items: center;
        }

        .option-btn:hover:not(:disabled) {
            border-color: var(--primary);
            background: var(--primary-light);
        }

        .option-btn:focus-visible {
            outline: 2px solid var(--primary);
            outline-offset: 2px;
        }

        .option-btn.selected {
            border-color: var(--primary);
            background: var(--primary-light);
            font-weight: 600;
        }

        /* Feedback States */
        .option-btn.correct {
            border-color: var(--success);
            background: var(--success-bg);
            color: #065F46;
        }
        
        .option-btn.incorrect {
            border-color: var(--error);
            background: var(--error-bg);
            opacity: 0.7;
        }

        .feedback-icon {
            margin-left: auto;
            font-size: 1.2rem;
        }

        /* --- FEEDBACK BOX --- */
        .feedback-panel {
            margin-top: 24px;
            padding: 20px;
            border-radius: var(--radius);
            animation: slideUp 0.3s ease-out;
        }

        .feedback-panel.success {
            background: var(--success-bg);
            border: 2px solid var(--success);
        }

        .feedback-panel.error {
            background: var(--error-bg);
            border: 2px solid var(--error);
        }

        .feedback-title {
            font-weight: 700;
            font-size: 1.1rem;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        /* --- BUTTONS --- */
        .action-btn {
            background: var(--primary);
            color: white;
            border: none;
            padding: 14px 32px;
            border-radius: 50px;
            font-weight: 600;
            font-size: 1rem;
            cursor: pointer;
            transition: var(--transition);
            display: inline-flex;
            align-items: center;
            gap: 8px;
            margin-top: 20px;
            width: 100%;
            justify-content: center;
        }

        .action-btn:hover:not(:disabled) {
            background: var(--primary-hover);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(79, 70, 229, 0.3);
        }

        .action-btn:disabled {
            background: #9CA3AF;
            cursor: not-allowed;
            opacity: 0.7;
        }

        .action-btn.secondary {
            background: white;
            color: var(--text-main);
            border: 2px solid #E5E7EB;
        }

        .action-btn.secondary:hover {
            border-color: var(--text-main);
            background: #F9FAFB;
        }

        /* --- RESULTS SCREEN --- */
        .results-card {
            text-align: center;
            padding: 20px;
        }

        .score-circle {
            width: 120px;
            height: 120px;
            background: linear-gradient(135deg, var(--success) 0%, #059669 100%);
            color: white;
            border-radius: 50%;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            margin: 0 auto 24px;
            box-shadow: 0 10px 20px rgba(16, 185, 129, 0.2);
        }

        .score-number { font-size: 2.5rem; font-weight: 800; line-height: 1; }
        .score-label { font-size: 0.8rem; text-transform: uppercase; font-weight: 600; opacity: 0.9; }

        .region-reveal {
            background: var(--primary-light);
            padding: 20px;
            border-radius: var(--radius);
            margin-bottom: 24px;
        }

        /* --- ANIMATIONS --- */
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        @keyframes slideUp { from { transform: translateY(10px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }

        /* --- RESPONSIVE --- */
        @media (min-width: 600px) {
            .action-btn { width: auto; }
            .content-area { padding: 40px; }
            .button-group { display: flex; justify-content: center; gap: 16px; }
        }
    </style>
</head>
<body>

    <div class="app-container">
        <header>
            <h1>US Dialect Detective Agency</h1>
            <div class="subtitle">Linguistic Forensics Division</div>
        </header>

        <!-- CHARACTER SELECTION VIEW -->
        <main id="view-selection" class="content-area">
            <h2>üìÇ Choose Your Case File</h2>
            <p>We have 5 unidentified speakers from across the United States. Select a case file to analyze their speech patterns and determine their region of origin.</p>
            
            <div class="case-grid" id="character-grid" role="list">
                <!-- Case files injected via JS -->
            </div>
        </main>

        <!-- QUIZ VIEW -->
        <main id="view-quiz" class="content-area hidden" aria-live="polite">
            <div class="progress-container">
                <div class="progress-header">
                    <span id="progress-text">Clue 1 of 6</span>
                    <span id="case-id">Case #1</span>
                </div>
                <div class="progress-track">
                    <div id="progress-fill" class="progress-fill" role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100"></div>
                </div>
            </div>

            <div class="mission-dossier">
                <span class="dossier-label">EVIDENCE: AUDIO TRANSCRIPT</span>
                <div id="dialogue-box" class="dialogue-text"></div>
            </div>

            <div id="question-area">
                <h3 id="question-text" class="question-text"></h3>
                <div id="options-list" class="options-list">
                    <!-- Options injected via JS -->
                </div>
                
                <button id="btn-submit" class="action-btn" disabled>
                    Submit Analysis
                </button>
            </div>

            <!-- Feedback Area (Hidden initially) -->
            <div id="feedback-area" class="hidden">
                <div id="feedback-panel" class="feedback-panel">
                    <div id="feedback-title" class="feedback-title"></div>
                    <p id="feedback-explanation"></p>
                </div>
                <div style="text-align: center;">
                    <button id="btn-next" class="action-btn">Next Clue ‚Üí</button>
                </div>
            </div>
        </main>

        <!-- RESULTS VIEW -->
        <main id="view-results" class="content-area hidden" aria-live="polite">
            <div class="results-card">
                <div class="score-circle">
                    <span id="final-score" class="score-number">0/0</span>
                    <span class="score-label">Score</span>
                </div>

                <h2 id="score-title">Case Closed!</h2>
                
                <div class="region-reveal">
                    <p class="dossier-label">IDENTITY CONFIRMED</p>
                    <h3 id="reveal-region" style="font-size: 1.5rem; color: var(--primary); margin: 8px 0;"></h3>
                    <p id="reveal-text" style="font-size: 0.95rem;"></p>
                </div>

                <div class="button-group">
                    <button onclick="restartGame()" class="action-btn">Analyze Another Speaker</button>
                </div>
            </div>
        </main>
    </div>

    <script>
        // --- DATA MODEL ---
        const characters = [
            {
                id: 1,
                emoji: "ü§†",
                descriptor: "Likes sweet tea & 'fixins'",
                region: "The South",
                dialogue: "Hey y'all! I just got back from the grocery store where I picked up some Coke, sweet tea, and fixins for dinner. It's fixin' to rain, so I reckon we should stay inside tonight. Bless your heart for asking!",
                fullExplanation: "This speaker uses classic Southern markers: 'y'all' (plural you), 'fixin' to' (preparing to), and 'Coke' as a generic term for soda.",
                questions: [
                    { q: "How does the speaker address a group?", options: ["You guys", "Y'all", "Youse", "You all"], correct: 1, explain: "'Y'all' is the quintessential Southern contraction of 'you all'." },
                    { q: "What do they call a carbonated beverage?", options: ["Soda", "Pop", "Coke", "Soft drink"], correct: 2, explain: "In the South, 'Coke' is often used generically for any soda, not just Coca-Cola." },
                    { q: "'Fixin' to' means...", options: ["It's raining now", "It's about to rain", "It stopped raining", "It might rain"], correct: 1, explain: "'Fixin' to' implies immediate future action or preparation." },
                    { q: "What are 'fixins'?", options: ["Utensils", "Ingredients/Sides", "Decorations", "Recipes"], correct: 1, explain: "'Fixins' refers to the necessary ingredients or side dishes for a meal." },
                    { q: "'I reckon' means...", options: ["I remember", "I think/suppose", "I forgot", "I heard"], correct: 1, explain: "'Reckon' is a common regionalism for thinking, supposing, or believing." },
                    { q: "Tone of 'Bless your heart'?", options: ["Genuine compliment", "Polite/Sweet expression", "Sarcasm", "A blessing"], correct: 1, explain: "It can range from genuine sympathy to polite dismissal depending on context." }
                ]
            },
            {
                id: 2,
                emoji: "üóΩ",
                descriptor: "Gets 'cawfee' & a hero",
                region: "New York City",
                dialogue: "Yo, I just grabbed some cawfee and a hero with a schmear from the bodega. I'm waiting on line to catch the train to the city. This weather is deadass crazy today - fuhgeddaboudit!",
                fullExplanation: "Classic NYC speech! Key markers include 'cawfee', 'on line' (instead of in line), 'bodega' (corner store), and 'hero' (sandwich).",
                questions: [
                    { q: "Pronunciation of 'coffee'?", options: ["Coffee", "Cawfee", "Coff-eh", "Caffee"], correct: 1, explain: "The 'aw' sound in 'cawfee' is a hallmark of the NYC accent." },
                    { q: "What is a 'hero'?", options: ["Sub sandwich", "A brave person", "A bagel", "Pizza slice"], correct: 0, explain: "A 'hero' is the NYC term for a submarine sandwich." },
                    { q: "What is a 'bodega'?", options: ["Corner store", "Supermarket", "Gas station", "Restaurant"], correct: 0, explain: "Bodegas are small, independent convenience stores ubiquitous in NYC." },
                    { q: "How do they wait for the train?", options: ["In line", "On line", "In queue", "In a row"], correct: 1, explain: "New Yorkers uniquely stand 'on line' rather than 'in line'." },
                    { q: "'The city' refers to...", options: ["Any city", "Their hometown", "Manhattan", "Brooklyn"], correct: 2, explain: "To a New Yorker, 'The City' specifically means the borough of Manhattan." },
                    { q: "'Deadass' means...", options: ["Tired", "Seriously/Really", "Wrong", "Quiet"], correct: 1, explain: "'Deadass' is slang for 'seriously' or 'truthfully'." }
                ]
            },
            {
                id: 3,
                emoji: "üåæ",
                descriptor: "Says 'ope' & drinks pop",
                region: "The Midwest",
                dialogue: "Ope, sorry there! I was just heading to the store to pick up some pop and bratwurst for the cookout. It's supposed to be pretty nice out, so I figured we could fire up the grill by the crick.",
                fullExplanation: "This represents the Midwest! 'Ope' is the classic polite exclamation, they drink 'pop', eat 'brats', and sit by the 'crick' (creek).",
                questions: [
                    { q: "What is 'Ope'?", options: ["Goodbye", "Polite exclamation", "Yes", "No"], correct: 1, explain: "Used when bumping into someone or realizing a small mistake." },
                    { q: "What is 'pop'?", options: ["Soda", "Juice", "Water", "Milk"], correct: 0, explain: "Midwesterners overwhelmingly call carbonated drinks 'pop'." },
                    { q: "Food mentioned?", options: ["Hot dogs", "Bratwurst", "BBQ", "Burgers"], correct: 1, explain: "Bratwursts (brats) reflect the German heritage common in the Midwest." },
                    { q: "Event type?", options: ["Barbecue", "Cookout", "Grill-out", "Party"], correct: 1, explain: "'Cookout' is a common term for an informal outdoor meal." },
                    { q: "Pronunciation of 'creek'?", options: ["Creek", "Crick", "Crik", "Creak"], correct: 1, explain: "Many in the Midwest (and parts of the South) pronounce it 'crick'." },
                    { q: "Tone of speaker?", options: ["Formal", "Polite/Friendly", "Rude", "Rushed"], correct: 1, explain: "Midwestern speech is often characterized by 'Midwest Nice'." }
                ]
            },
            {
                id: 4,
                emoji: "üèÑ",
                descriptor: "Says 'hella' & 'gnarly'",
                region: "California / West Coast",
                dialogue: "Dude, that concert was hella sick! The band was totally rad, and the crowd was super chill. I'm gonna grab some In-N-Out and then hit the beach. The waves are gnarly today!",
                fullExplanation: "This is West Coast/California dialect. 'Hella' implies Northern CA, while 'gnarly', 'rad', and 'chill' come from surf/skate culture.",
                questions: [
                    { q: "'Hella' means...", options: ["Hello", "Very/Really", "Kind of", "Not really"], correct: 1, explain: "An intensifier originating in Northern California meaning 'very'." },
                    { q: "'Sick' means...", options: ["Ill", "Awesome", "Bad", "Loud"], correct: 1, explain: "Slang for excellent, cool, or impressive." },
                    { q: "Burger chain mentioned?", options: ["McDonald's", "In-N-Out", "Burger King", "Shake Shack"], correct: 1, explain: "In-N-Out is a cultural icon of the West Coast." },
                    { q: "'Chill' means...", options: ["Cold", "Relaxed", "Boring", "Scary"], correct: 1, explain: "Relaxed, easy-going, or calm." },
                    { q: "'Gnarly' waves are...", options: ["Small", "Challenging/Awesome", "Dirty", "Flat"], correct: 1, explain: "Originally meant dangerous, now means intense or awesome." },
                    { q: "Activity planned?", options: ["Shopping", "Beach", "Sleeping", "Hiking"], correct: 1, explain: "Beach culture is central to the dialect's lexicon." }
                ]
            },
            {
                id: 5,
                emoji: "üêä",
                descriptor: "Mentions 'Pub subs' & gators",
                region: "Florida",
                dialogue: "Oye, jit! I'm heading to Publix to grab a pub sub before these love bugs get worse. The snowbirds are back, so traffic is insane. Dale, let's go before that gator crosses the road!",
                fullExplanation: "Welcome to Florida! 'Pub subs' (Publix sandwiches), 'snowbirds' (winter tourists), 'jit' (kid), and 'dale' (let's go) are key Sunshine State terms.",
                questions: [
                    { q: "'Oye' is...", options: ["Goodbye", "A Greeting", "No", "Yes"], correct: 1, explain: "A Spanish greeting common in FL due to Hispanic influence." },
                    { q: "What is a 'Pub sub'?", options: ["Subway sandwich", "Publix sandwich", "Boat", "Drink"], correct: 1, explain: "A cult-favorite sandwich from the Publix supermarket chain." },
                    { q: "'Love bugs' are...", options: ["Cute beetles", "Annoying flies", "Spiders", "Ants"], correct: 1, explain: "Connected flies that swarm FL highways twice a year." },
                    { q: "'Snowbirds' are...", options: ["Actual birds", "Winter residents", "Skiers", "Penguins"], correct: 1, explain: "Northerners who move to FL during the winter months." },
                    { q: "'Dale' means...", options: ["Stop", "Let's go/Do it", "Wait", "Hello"], correct: 1, explain: "Cuban slang popularized by Pitbull, meaning 'go ahead' or 'do it'." },
                    { q: "Animal mentioned?", options: ["Bear", "Alligator", "Shark", "Snake"], correct: 1, explain: "Gators are a common sight (and hazard) in Florida." }
                ]
            }
        ];

        // --- STATE MANAGEMENT ---
        let currentState = {
            character: null,
            qIndex: 0,
            score: 0,
            selectedOption: null
        };

        // --- DOM ELEMENTS ---
        const views = {
            selection: document.getElementById('view-selection'),
            quiz: document.getElementById('view-quiz'),
            results: document.getElementById('view-results')
        };

        const els = {
            grid: document.getElementById('character-grid'),
            dialogue: document.getElementById('dialogue-box'),
            progressText: document.getElementById('progress-text'),
            progressFill: document.getElementById('progress-fill'),
            questionText: document.getElementById('question-text'),
            optionsList: document.getElementById('options-list'),
            submitBtn: document.getElementById('btn-submit'),
            questionArea: document.getElementById('question-area'),
            feedbackArea: document.getElementById('feedback-area'),
            feedbackPanel: document.getElementById('feedback-panel'),
            feedbackTitle: document.getElementById('feedback-title'),
            feedbackExplanation: document.getElementById('feedback-explanation'),
            nextBtn: document.getElementById('btn-next'),
            finalScore: document.getElementById('final-score'),
            revealRegion: document.getElementById('reveal-region'),
            revealText: document.getElementById('reveal-text'),
            caseId: document.getElementById('case-id')
        };

        // --- INIT ---
        function init() {
            renderCharacterGrid();
        }

        function renderCharacterGrid() {
            els.grid.innerHTML = characters.map((char, index) => `
                <button class="case-file" onclick="startCase(${index})" aria-label="Select Case File ${index + 1}: ${char.descriptor}">
                    <span class="case-badge">Case File #${index + 1}</span>
                    <span class="case-emoji" role="img" aria-hidden="true">${char.emoji}</span>
                    <h3 style="font-weight: 600; margin: 10px 0 4px;">Mystery Speaker</h3>
                    <p style="font-size: 0.9rem; color: var(--text-muted); margin: 0;">${char.descriptor}</p>
                </button>
            `).join('');
        }

        // --- QUIZ LOGIC ---
        function startCase(index) {
            currentState.character = characters[index];
            currentState.qIndex = 0;
            currentState.score = 0;
            
            switchView('quiz');
            els.caseId.textContent = `Case File #${index + 1}`;
            els.dialogue.textContent = `"${currentState.character.dialogue}"`;
            
            loadQuestion();
        }

        function loadQuestion() {
            const qData = currentState.character.questions[currentState.qIndex];
            const total = currentState.character.questions.length;
            
            // Reset UI
            els.feedbackArea.classList.add('hidden');
            els.questionArea.classList.remove('hidden');
            els.submitBtn.disabled = true;
            currentState.selectedOption = null;

            // Update Progress
            els.progressText.textContent = `Clue ${currentState.qIndex + 1} of ${total}`;
            const progressPct = ((currentState.qIndex) / total) * 100;
            els.progressFill.style.width = `${progressPct}%`;

            // Render Question
            els.questionText.textContent = qData.q;
            els.optionsList.innerHTML = qData.options.map((opt, i) => `
                <button class="option-btn" onclick="selectOption(${i})" id="opt-${i}">
                    <span style="font-weight:700; margin-right:12px; color:var(--primary);">${String.fromCharCode(65 + i)}.</span>
                    ${opt}
                </button>
            `).join('');
            
            // Focus management for accessibility
            document.getElementById('question-text').focus();
        }

        function selectOption(index) {
            // Remove previous selection styles
            document.querySelectorAll('.option-btn').forEach(btn => {
                btn.classList.remove('selected');
                btn.setAttribute('aria-pressed', 'false');
            });

            // Apply new selection
            const btn = document.getElementById(`opt-${index}`);
            btn.classList.add('selected');
            btn.setAttribute('aria-pressed', 'true');
            
            currentState.selectedOption = index;
            els.submitBtn.disabled = false;
        }

        els.submitBtn.addEventListener('click', () => {
            const qData = currentState.character.questions[currentState.qIndex];
            const isCorrect = currentState.selectedOption === qData.correct;
            
            if (isCorrect) currentState.score++;

            // Show feedback
            els.questionArea.classList.add('hidden');
            els.feedbackArea.classList.remove('hidden');
            
            els.feedbackPanel.className = `feedback-panel ${isCorrect ? 'success' : 'error'}`;
            els.feedbackTitle.innerHTML = isCorrect 
                ? '<span role="img" aria-label="Checkmark">‚úÖ</span> Correct Analysis!' 
                : '<span role="img" aria-label="Cross">‚ùå</span> Theory Disproven';
            
            els.feedbackExplanation.innerHTML = `
                <strong>Answer: ${qData.options[qData.correct]}</strong><br><br>
                ${qData.explain}
            `;
            
            // Update Next Button Text
            const isLast = currentState.qIndex === currentState.character.questions.length - 1;
            els.nextBtn.textContent = isLast ? "Close Case (View Results)" : "Next Clue ‚Üí";
            
            els.nextBtn.onclick = isLast ? showResults : nextQuestion;
            els.nextBtn.focus();
            
            // Update progress bar to completed step
            const total = currentState.character.questions.length;
            els.progressFill.style.width = `${((currentState.qIndex + 1) / total) * 100}%`;
        });

        function nextQuestion() {
            currentState.qIndex++;
            loadQuestion();
        }

        function showResults() {
            switchView('results');
            const total = currentState.character.questions.length;
            
            els.finalScore.textContent = `${currentState.score}/${total}`;
            els.revealRegion.textContent = currentState.character.region;
            els.revealText.textContent = currentState.character.fullExplanation;
            
            // Dynamic Title based on score
            const percentage = currentState.score / total;
            const title = document.getElementById('score-title');
            if(percentage === 1) title.textContent = "Master Detective! üïµÔ∏è‚Äç‚ôÄÔ∏è";
            else if(percentage > 0.6) title.textContent = "Solid Police Work üëÆ‚Äç‚ôÇÔ∏è";
            else title.textContent = "Back to the Academy üìö";
        }

        function restartGame() {
            switchView('selection');
            currentState = { character: null, qIndex: 0, score: 0, selectedOption: null };
        }

        // --- UTILS ---
        function switchView(viewName) {
            Object.values(views).forEach(el => el.classList.add('hidden'));
            views[viewName].classList.remove('hidden');
            window.scrollTo(0, 0);
        }

        // Start
        init();

    </script>
</body>
</html>
